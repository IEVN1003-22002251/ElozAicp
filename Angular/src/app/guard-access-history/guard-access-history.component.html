<div class="guard-history-container">
  <header class="guard-history-header">
    <h1 class="history-title">Historial de Accesos en Tiempo Real</h1>
    <div class="header-actions">
      <div class="refresh-indicator" [class.refreshing]="loading">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="23 4 23 10 17 10"></polyline>
          <polyline points="1 20 1 14 7 14"></polyline>
          <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path>
        </svg>
        <span>Actualizando cada 5 segundos</span>
      </div>
      <button class="btn-back" (click)="goBack()">← Volver</button>
    </div>
  </header>

  <div class="filter-buttons">
    <button 
      class="filter-btn" 
      [class.active]="selectedFilter === 'all'"
      (click)="setFilter('all')">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <rect x="3" y="3" width="7" height="7"></rect>
        <rect x="14" y="3" width="7" height="7"></rect>
        <rect x="14" y="14" width="7" height="7"></rect>
        <rect x="3" y="14" width="7" height="7"></rect>
      </svg>
      <span>Todos</span>
    </button>
    
    <button 
      class="filter-btn filter-residents" 
      [class.active]="selectedFilter === 'residents'"
      (click)="setFilter('residents')">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
        <polyline points="9 22 9 12 15 12 15 22"></polyline>
      </svg>
      <span>Residentes</span>
    </button>
    
    <button 
      class="filter-btn filter-visitors" 
      [class.active]="selectedFilter === 'visitors'"
      (click)="setFilter('visitors')">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
        <circle cx="12" cy="7" r="4"></circle>
      </svg>
      <span>Visitantes</span>
    </button>
    
    <button 
      class="filter-btn filter-providers" 
      [class.active]="selectedFilter === 'providers'"
      (click)="setFilter('providers')">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"></path>
      </svg>
      <span>Proveedores</span>
    </button>
  </div>

  <div class="stats-section">
    <div class="stat-card">
      <div class="stat-icon stat-icon-total">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
          <circle cx="9" cy="7" r="4"></circle>
          <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
          <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
        </svg>
      </div>
      <div class="stat-info">
        <p class="stat-label">Total</p>
        <p class="stat-value">{{ totalAccesses }}</p>
      </div>
    </div>
    
    <div class="stat-card">
      <div class="stat-icon stat-icon-dentro">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M9 11l3 3L22 4"></path>
          <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"></path>
        </svg>
      </div>
      <div class="stat-info">
        <p class="stat-label">Dentro</p>
        <p class="stat-value">{{ dentroCount }}</p>
      </div>
    </div>
    
    <div class="stat-card">
      <div class="stat-icon stat-icon-salio">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M9 18l6-6-6-6"></path>
        </svg>
      </div>
      <div class="stat-info">
        <p class="stat-label">Salió</p>
        <p class="stat-value">{{ salioCount }}</p>
      </div>
    </div>
  </div>

  <div class="content-area">
    <div *ngIf="filteredAccesses.length === 0 && !loading" class="empty-state">
      <div class="empty-icon">
        <svg width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
          <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
          <polyline points="14 2 14 8 20 8"></polyline>
          <line x1="16" y1="13" x2="8" y2="13"></line>
          <line x1="16" y1="17" x2="8" y2="17"></line>
        </svg>
      </div>
      <p class="empty-title">No hay accesos registrados</p>
      <p class="empty-message">Los accesos aparecerán aquí cuando se registren en el sistema.</p>
    </div>

    <div *ngIf="loading && filteredAccesses.length === 0" class="loading-state">
      <div class="loading-spinner"></div>
      <p>Cargando accesos...</p>
    </div>

    <div *ngIf="filteredAccesses.length > 0" class="accesses-list">
      <div 
        *ngFor="let access of filteredAccesses" 
        class="access-item"
        [class.access-dentro]="access.status === 'dentro'"
        [class.access-salio]="access.status === 'salio' || access.status === 'salió'">
        <div class="access-type-badge" [class]="'badge-' + access.type">
          <svg *ngIf="access.type === 'resident'" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
            <polyline points="9 22 9 12 15 12 15 22"></polyline>
          </svg>
          <svg *ngIf="access.type === 'visitor' || access.type === 'one-time'" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
            <circle cx="12" cy="7" r="4"></circle>
          </svg>
          <svg *ngIf="access.type === 'provider'" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"></path>
          </svg>
          <span>{{ getTypeLabel(access.type) }}</span>
        </div>
        
        <div class="access-info">
          <h3 class="access-name">{{ access.name || access.visitor_name || 'N/A' }}</h3>
          <p class="access-details" *ngIf="access.resident_name">
            Residente: {{ access.resident_name }}
          </p>
          <p class="access-details" *ngIf="access.resident_address">
            Domicilio: {{ access.resident_address }}
          </p>
          <p class="access-time">{{ formatDate(access.created_at || access.timestamp) }}</p>
        </div>
        
        <div class="access-status">
          <span class="status-badge" 
                [class.status-dentro]="access.status === 'dentro'"
                [class.status-salio]="access.status === 'salio' || access.status === 'salió'"
                [class.status-active]="access.status === 'active' || access.status === 'activo'">
            {{ getStatusLabel(access.status) }}
          </span>
        </div>
      </div>
    </div>
  </div>
</div>


