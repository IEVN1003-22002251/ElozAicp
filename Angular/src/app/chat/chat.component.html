<div class="chat-container" [class.admin-layout]="isAdmin">
  <!-- Header para Admin -->
  <header class="chat-header-admin" *ngIf="isAdmin">
    <button class="btn-back" (click)="goBack()">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M19 12H5M12 19l-7-7 7-7"/>
      </svg>
      Regresar
    </button>
    <h1 class="chat-title">Chat con Residentes</h1>
  </header>

  <!-- Header para Residente -->
  <div class="chat-header" *ngIf="!isAdmin">
    <h1 class="chat-title">Chat</h1>
  </div>

  <!-- Layout para Admin: Lista de Residentes + Conversación -->
  <div class="admin-chat-layout" *ngIf="isAdmin">
    <!-- Lista de Residentes -->
    <div class="residents-sidebar">
      <div class="sidebar-header">
        <h2 class="sidebar-title">Residentes</h2>
      </div>
      <div class="residents-list">
        <div class="loading-state" *ngIf="loadingResidents">
          <p>Cargando residentes...</p>
        </div>
        <div class="empty-state" *ngIf="!loadingResidents && residents.length === 0">
          <p>No hay residentes disponibles</p>
        </div>
        <div 
          class="resident-item" 
          *ngFor="let resident of residents"
          [class.active]="selectedResident?.id === resident.id"
          (click)="selectResident(resident)"
        >
          <div class="resident-avatar">
            {{ (resident.name || resident.user_name || 'U')[0].toUpperCase() }}
          </div>
          <div class="resident-info">
            <h3 class="resident-name">{{ resident.name || resident.user_name || 'Sin nombre' }}</h3>
            <p class="resident-email">{{ resident.email || 'Sin email' }}</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Área de Conversación -->
    <div class="conversation-area">
      <div class="conversation-header" *ngIf="selectedResident">
        <div class="conversation-user-info">
          <div class="conversation-avatar">
            {{ (selectedResident.name || selectedResident.user_name || 'U')[0].toUpperCase() }}
          </div>
          <div>
            <h3 class="conversation-name">{{ selectedResident.name || selectedResident.user_name || 'Sin nombre' }}</h3>
            <p class="conversation-status">En línea</p>
          </div>
        </div>
      </div>

      <div class="conversation-empty" *ngIf="!selectedResident">
        <p>Selecciona un residente para comenzar una conversación</p>
      </div>

      <!-- Messages Area -->
      <div class="messages-area" *ngIf="selectedResident">
        <div class="empty-messages" *ngIf="messages.length === 0">
          <p>No hay mensajes aún. Envía el primer mensaje.</p>
        </div>

        <div class="messages-list" *ngIf="messages.length > 0">
          <div 
            class="message-item" 
            *ngFor="let message of messages"
            [class.sent]="message.sent"
            [class.received]="!message.sent"
          >
            <div class="message-content">
              <p class="message-text">{{ message.text }}</p>
              <span class="message-time">{{ message.time }}</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Message Input -->
      <div class="message-input-container" *ngIf="selectedResident">
        <input
          type="text"
          class="message-input"
          placeholder="Escribe un mensaje..."
          [(ngModel)]="newMessage"
          (keyup.enter)="sendMessage()"
          name="message"
        />
        <button class="send-button" (click)="sendMessage()" [disabled]="!newMessage.trim()">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="22" y1="2" x2="11" y2="13"></line>
            <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
          </svg>
        </button>
      </div>
    </div>
  </div>

  <!-- Layout para Residente: Tabs + Mensajes -->
  <div class="resident-chat-layout" *ngIf="!isAdmin">
    <!-- Tabs -->
    <div class="chat-tabs">
      <button 
        class="tab-button" 
        [class.active]="activeTab === 'administration'"
        (click)="selectTab('administration')"
      >
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path>
        </svg>
        <span>Administración</span>
      </button>
      <button 
        class="tab-button" 
        [class.active]="activeTab === 'security'"
        (click)="selectTab('security')"
      >
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
          <path d="M9 12l2 2 4-4"></path>
        </svg>
        <span>Seguridad</span>
      </button>
    </div>

    <!-- Messages Area -->
    <div class="messages-area">
      <div class="empty-messages" *ngIf="messages.length === 0">
        <!-- Empty area, no content displayed -->
      </div>

      <div class="messages-list" *ngIf="messages.length > 0">
        <div 
          class="message-item" 
          *ngFor="let message of messages"
          [class.sent]="message.sent"
          [class.received]="!message.sent"
        >
          <div class="message-content">
            <p class="message-text">{{ message.text }}</p>
            <span class="message-time">{{ message.time }}</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Message Input -->
    <div class="message-input-container">
      <input
        type="text"
        class="message-input"
        placeholder="Escribe un mensaje..."
        [(ngModel)]="newMessage"
        (keyup.enter)="sendMessage()"
        name="message"
      />
      <button class="send-button" (click)="sendMessage()" [disabled]="!newMessage.trim()">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="22" y1="2" x2="11" y2="13"></line>
          <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
        </svg>
      </button>
    </div>
  </div>

  <!-- Bottom Navigation - Solo para Residentes -->
  <nav class="bottom-nav" *ngIf="!isAdmin">
    <div class="nav-item" (click)="navigateTo('home')">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
        <polyline points="9 22 9 12 15 12 15 22"></polyline>
      </svg>
      <span>Inicio</span>
    </div>
    <div class="nav-item active" (click)="navigateTo('chat')">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
      </svg>
      <span>Chat</span>
    </div>
    <div class="nav-item" (click)="navigateTo('notifications')">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
        <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
      </svg>
      <span>Notificaciones</span>
    </div>
    <div class="nav-item" (click)="navigateTo('profile')">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
        <circle cx="12" cy="7" r="4"></circle>
      </svg>
      <span>Perfil</span>
    </div>
  </nav>
</div>
